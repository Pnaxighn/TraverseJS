<!DOCTYPE html>
<html>
  <head>
    <title>A Garden of Forking Paths</title>
    <script type="text/javascript" src="jquery-1.7.js"></script>
    <script type="text/javascript" src="../Traverse.js"></script>
<!--    <script type="text/javascript" src="Garden.js"></script> -->
    <script type="text/javascript">
	with ( TraverseCore ) {
/*
		new Action("foo", [function(){alert('foo');}]);
		new Action("bar", [function(){alert('bar');}], [function(){return true;}]);
		new Action("baz", [function(){alert('baz');}], [function(){return false;}]);
		ResolveAction("foo").Run();
		ResolveAction("bar").Run();
		ResolveAction("baz").Run();
*/

		CreateChoice( "Barbara Marries", [ { "Name":"Charles", Results:[] }, { "Name":"William", Results:[] } ], [] );
		GetOnceAction( "Charles Cheats", [ function(){alert('cheated!');} ], [ ChoiceMade( "Barbara Marries Charles" ) ] );

    var getActionButtonClicked = function(action) {
      return function() {
        action.Run(); 
        renderActionList();
      };
    };

    var renderActionList = function() {
      var $choices = $('#choices');
      $choices.empty();
      var avail = GetAllEligibleActions();
      for (var i in avail) {
        var action = avail[i];
        
        var $actionButton = $('<button>' + action.Name + '</button>');
        $actionButton.bind('click', getActionButtonClicked(action));
        
        var $listItem = $('<li></li>').append($actionButton);
        $choices.append($listItem);
      }
    }

    $(function() {
      renderActionList();
    });
	}
//      Traverse.start(document.getElementById("choices"));
    </script>
  </head>
  <body>
    <h1>A Garden of Forking Paths</h1>
    <ul id="choices"></ul>
  </body>
</html>